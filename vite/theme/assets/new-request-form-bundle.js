const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["wysiwyg-bundle.js","shared-bundle.js"])))=>i.map(i=>d[i]);
var at=Object.defineProperty,ot=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var lt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var Se=(t,n,s)=>n in t?at(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,q=(t,n)=>{for(var s in n||(n={}))lt.call(n,s)&&Se(t,s,n[s]);if(ke)for(var s of ke(n))ct.call(n,s)&&Se(t,s,n[s]);return t},R=(t,n)=>ot(t,it(n));var N=(t,n,s)=>new Promise((i,o)=>{var l=r=>{try{a(s.next(r))}catch(c){o(c)}},u=r=>{try{a(s.throw(r))}catch(c){o(c)}},a=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,u);a((s=s.apply(t,n)).next())});import{j as e,F as W,L as K,S as M,H as J,I as le,M as Y,r as h,u as Ge,a as H,N as Ne,T as Me,C as Ue,q as I,b as ut,d as ne,e as se,f as ce,g as re,O as G,h as ue,i as dt,k as Ve,p as mt,l as He,m as he,n as je,P as qe,A as de,o as pt,s as ht,D as ft,t as gt,K as oe,v as ze,w as xt,x as ve,y as jt,z as vt,B as bt,W as yt,E as wt,G as Ct,J as _t,Q as kt,R as St,U as qt,V as Q,X as Be,Y as Tt,Z as Te,_ as be,$ as It,a0 as fe,a1 as Ft,a2 as Et,a3 as Pt,a4 as Dt,a5 as Lt,a6 as Rt,a7 as $t,a8 as At}from"shared";function ge({field:t,onChange:n}){const{label:s,error:i,value:o,name:l,required:u,description:a,type:r}=t,c={},d=r==="integer"||r==="decimal"?"number":"text";r==="integer"&&(c.step="1"),r==="decimal"&&(c.step="any");const m=r==="anonymous_requester_email"?"email":void 0;return e.jsxs(W,{children:[e.jsxs(K,{children:[s,u&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),a&&e.jsx(J,{dangerouslySetInnerHTML:{__html:a}}),e.jsx(le,q({name:l,type:d,defaultValue:o,validation:i?"error":void 0,required:u,onChange:p=>{n&&n(p.target.value)},autoComplete:m},c)),i&&e.jsx(Y,{validation:"error",children:i})]})}const Ot="modulepreload",Gt=function(t){return"/"+t},Ie={},Nt=function(n,s,i){let o=Promise.resolve();if(s&&s.length>0){let u=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=u(s.map(c=>{if(c=Gt(c),c in Ie)return;Ie[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Ot,d||(p.as="script"),p.crossOrigin="",p.href=c,r&&p.setAttribute("nonce",r),document.head.appendChild(p),d)return new Promise((b,v)=>{p.addEventListener("load",b),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return o.then(u=>{for(const a of u||[])a.status==="rejected"&&l(a.reason);return n().catch(l)})};function Mt({hasWysiwyg:t,baseLocale:n,hasAtMentions:s,userRole:i,brandId:o}){const l=h.useRef(!1),{addToast:u}=Ge(),{t:a}=H();return h.useCallback(r=>N(this,null,function*(){if(t&&r&&!l.current){l.current=!0;const{createEditor:c}=yield Nt(()=>N(this,null,function*(){const{createEditor:p}=yield import("wysiwyg").then(b=>b.m);return{createEditor:p}}),__vite__mapDeps([0,1]));(yield c(r,{editorType:"supportRequests",hasAtMentions:s,userRole:i,brandId:o,baseLocale:n})).plugins.get("Notification").on("show",(p,b)=>{p.stop();const v=b.message instanceof Error?b.message.message:b.message,{type:x,title:y}=b;u(({close:f})=>e.jsxs(Ne,{type:x,children:[e.jsx(Me,{children:y}),v,e.jsx(Ue,{"aria-label":a("new-request-form.close-label","Close"),onClick:f})]}))})}}),[t,n,s,i,o,u,a])}const Ut=I(W)`
  .ck.ck-editor {
    margin-top: ${t=>t.theme.space.xs};
  }
`,Vt=I(Y)`
  .ck.ck-editor + & {
    margin-top: ${t=>t.theme.space.xs};
  }
`;function Fe({field:t,hasWysiwyg:n,baseLocale:s,hasAtMentions:i,userRole:o,brandId:l,onChange:u}){const{label:a,error:r,value:c,name:d,required:m,description:p}=t,b=Mt({hasWysiwyg:n,baseLocale:s,hasAtMentions:i,userRole:o,brandId:l});return e.jsxs(Ut,{children:[e.jsxs(K,{children:[a,m&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),p&&e.jsx(J,{dangerouslySetInnerHTML:{__html:p}}),e.jsx(ut,{ref:b,name:d,defaultValue:c,validation:r?"error":void 0,required:m,onChange:v=>u(v.target.value),rows:6,isResizable:!0}),r&&e.jsx(Vt,{validation:"error",children:r})]})}function te(){const{t}=H();return e.jsxs(e.Fragment,{children:[e.jsx(M,{"aria-hidden":"true",children:"-"}),e.jsx(M,{hidden:!0,children:t("new-request-form.dropdown.empty-option","Select an option")})]})}function Ee({field:t,onChange:n}){const{label:s,options:i,error:o,value:l,name:u,required:a,description:r}=t,c=l==null?"":l.toString(),d=h.useRef(null);return h.useEffect(()=>{if(d.current&&a){const m=d.current.querySelector("[role=combobox]");m==null||m.setAttribute("aria-required","true")}},[d,a]),e.jsxs(ne,{children:[e.jsxs(se,{children:[s,a&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),r&&e.jsx(ce,{dangerouslySetInnerHTML:{__html:r}}),e.jsxs(re,{ref:d,inputProps:{name:u,required:a},isEditable:!1,validation:o?"error":void 0,inputValue:c,selectionValue:c,renderValue:({selection:m})=>(m==null?void 0:m.label)||e.jsx(te,{}),onChange:({selectionValue:m})=>{m!==void 0&&n(m)},children:[!a&&e.jsx(G,{value:"",label:"-",children:e.jsx(te,{})}),i.map(m=>e.jsx(G,{value:m.value.toString(),label:m.name},m.value))]}),o&&e.jsx(ue,{validation:"error",children:o})]})}function Ht({field:t,onChange:n}){const{label:s,error:i,value:o,name:l,required:u,description:a}=t,[r,c]=h.useState(o),d=m=>{const{checked:p}=m.target;c(p),n(p)};return e.jsxs(W,{children:[e.jsx("input",{type:"hidden",name:l,value:"off"}),e.jsxs(dt,{name:l,required:u,defaultChecked:o,value:r?"on":"off",onChange:d,children:[e.jsxs(K,{children:[s,u&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),a&&e.jsx(J,{dangerouslySetInnerHTML:{__html:a}})]}),i&&e.jsx(Y,{validation:"error",children:i})]})}const ye="[]";function ie(t){return`[${t.join("::")}]`}function zt(t){return t.startsWith("[")&&t.endsWith("]")}function Bt(t){const n=t.split("::");return[n.slice(0,-1),n.slice(-1)[0]]}function Pe(t){const n=t.slice(0,-1),s=ie(n);return{type:"SubGroup",name:t[t.length-1],backOption:{type:"previous",label:"Back",value:s},options:[]}}function Xt(t,n){const s={[ye]:{type:"RootGroup",options:n?[{label:"-",value:""}]:[]}};return t.forEach(i=>{var u,a,r;const{name:o,value:l}=i;if(!o.includes("::"))s[ye].options.push({value:l,label:o});else{const[c,d]=Bt(o),m=ie(c);s[m]||(s[m]=Pe(c)),(u=s[m])==null||u.options.push({value:l,label:o.split("::").join(" > "),menuLabel:d});for(let p=0;p<c.length;p++){const b=c.slice(0,p),v=c.slice(0,p+1),x=ie(b),y=ie(v);s[x]||(s[x]=Pe(b)),((a=s[x])==null?void 0:a.options.find(f=>f.value===y))===void 0&&((r=s[x])==null||r.options.push({type:"next",label:v[v.length-1],value:y}))}}}),s}function Wt(t){const n={type:"RootGroup",options:[]};return Object.values(t).forEach(({options:s})=>{n.options.push(...s.filter(({type:i})=>i===void 0))}),n}function Xe({options:t,hasEmptyOption:n}){const s=h.useMemo(()=>Xt(t,n),[t,n]),[i,o]=h.useState(Wt(s));return h.useEffect(()=>{o(s[ye])},[s]),{currentGroup:i,isGroupIdentifier:zt,setCurrentGroupByIdentifier:u=>{const a=s[u];a&&o(a)}}}function Kt({field:t}){const{label:n,options:s,error:i,value:o,name:l,required:u,description:a}=t,{currentGroup:r,isGroupIdentifier:c,setCurrentGroupByIdentifier:d}=Xe({options:s,hasEmptyOption:!1}),[m,p]=h.useState(o||[]),b=h.useRef(null);h.useEffect(()=>{if(b.current&&u){const x=b.current.querySelector("[role=combobox]");x==null||x.setAttribute("aria-required","true")}},[b,u]);const v=x=>{if(Array.isArray(x.selectionValue)){const y=x.selectionValue.slice(-1).toString();c(y)?d(y):p(x.selectionValue)}};return e.jsxs(ne,{children:[m.map(x=>e.jsx("input",{type:"hidden",name:`${l}[]`,value:x},x)),e.jsxs(se,{children:[n,u&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),a&&e.jsx(ce,{dangerouslySetInnerHTML:{__html:a}}),e.jsxs(re,{ref:b,isMultiselectable:!0,inputProps:{required:u},isEditable:!1,validation:i?"error":void 0,onChange:v,selectionValue:m,maxHeight:"auto",children:[r.type==="SubGroup"&&e.jsx(G,q({},r.backOption)),r.type==="SubGroup"?e.jsx(Ve,{"aria-label":r.name,children:r.options.map(x=>{var y;return e.jsx(G,R(q({},x),{children:(y=x.menuLabel)!=null?y:x.label}),x.value)})}):r.options.map(x=>e.jsx(G,q({},x),x.value))]}),i&&e.jsx(ue,{validation:"error",children:i})]})}const xe="return-focus-to-ticket-form-field";function Yt({field:t,newRequestPath:n}){const s=h.createRef(),i=({selectionValue:o})=>{if(o&&typeof o=="number"){const l=new URL(window.location.href);l.searchParams.set("ticket_form_id",o),sessionStorage.setItem(xe,"true"),window.location.assign(`${n}${l.search}`)}};return h.useEffect(()=>{var o,l;sessionStorage.getItem(xe)&&(sessionStorage.removeItem(xe),(l=(o=s.current)==null?void 0:o.firstChild)==null||l.focus())},[]),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"hidden",name:t.name,value:t.value}),t.options.length>1&&e.jsxs(ne,{children:[e.jsx(se,{children:t.label}),e.jsx(re,{isEditable:!1,onChange:i,ref:s,children:t.options.map(o=>e.jsx(G,{value:o.value,label:o.name,isSelected:t.value===o.value,children:o.name},o.value))})]})]})}function Jt({field:t}){const{value:n,name:s}=t;return e.jsx("input",{type:"hidden",name:s,value:n})}function Zt(){return N(this,null,function*(){const t=yield fetch("/api/v2/help_center/sessions.json"),{current_session:n}=yield t.json();return n.csrf_token})}function Qt(t){const n=h.useRef(!1),s=h.useRef(!1);return{formRefCallback:h.useCallback(l=>{l&&!n.current&&(n.current=!0,l.submit=()=>N(this,null,function*(){if(s.current===!1){s.current=!0;const u=yield Zt(),a=document.createElement("input");a.type="hidden",a.name="authenticity_token",a.value=u,l.appendChild(a);const r=t.filter(c=>c.type==="partialcreditcard");for(const c of r){const d=l.querySelector(`input[name="${c.name}"]`);d&&d instanceof HTMLInputElement&&d.value.length===4&&(d.value=`XXXXXXXXX${d.value}`)}HTMLFormElement.prototype.submit.call(l)}}))},[t]),handleSubmit:l=>{l.preventDefault(),l.target.submit()}}}const en=2048,De="tf_",tn=/^\d{4}-\d{2}-\d{2}$/,nn=["true","false"],sn=["pre","strong","b","p","blockquote","ul","ol","li","h2","h3","h4","i","em","br"];function rn(t,n){if(!Number.isNaN(Number(t))){const i=`request[custom_fields][${t}]`;return n.ticketFields.find(o=>o.name===i)}switch(t){case"anonymous_requester_email":return n.emailField;case"due_at":return n.dueDateField;case"collaborators":return n.ccField;case"organization_id":return n.organizationField;default:return n.ticketFields.find(i=>i.name===`request[${t}]`)}}function an(t){if(!tn.test(t))return!1;const n=new Date(t),[s,i,o]=t.split("-").map(Number);return n.getUTCFullYear()===s&&n.getUTCMonth()+1===i&&n.getUTCDate()===o}function on(t){const{href:n}=location,s=new URL(n).searchParams,i=R(q({},t),{ticketFields:[...t.ticketFields]});if(n.length>en||s.get("parent_id"))return t;for(const[o,l]of s){if(!o.startsWith(De))continue;const u=o.substring(De.length),a=rn(u,i);if(!a)continue;const r=mt.sanitize(l,{ALLOWED_TAGS:sn});switch(a.type){case"partialcreditcard":continue;case"multiselect":a.value=r.split(",").filter(c=>a.options.some(d=>d.value===c));break;case"checkbox":nn.includes(r)&&(a.value=r==="true"?"on":r==="false"?"off":"");break;case"due_at":case"date":an(r)&&(a.value=r);break;default:a.value=r}}return i}function ln({ticketFields:t,ccField:n,dueDateField:s,emailField:i,organizationField:o}){return h.useMemo(()=>on({ticketFields:t,ccField:n,dueDateField:s,emailField:i,organizationField:o}),[t,n,s,i,o])}const Le=I.div`
  flex: 1;
`;function cn({file:t,onRemove:n}){const{t:s}=H(),i=r=>{(r.code==="Delete"||r.code==="Backspace")&&(r.preventDefault(),n())},o=r=>{(r.code==="Enter"||r.code==="Space"||r.code==="Delete"||r.code==="Backspace")&&(r.preventDefault(),n())},l=t.status==="pending"?t.file_name:t.value.file_name,u=s("new-request-form.attachments.stop-upload","Stop upload"),a=s("new-request-form.attachments.remove-file","Remove file");return e.jsx(He.Item,{children:e.jsx(he,{type:"generic",tabIndex:0,"aria-label":s("new-request-form.attachments.file","File: {{fileName}}, press delete to remove",{fileName:l}),onKeyDown:i,children:t.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(Le,{children:l}),e.jsx(je,{content:u,children:e.jsx(he.Close,{"aria-label":s("new-request-form.attachments.stop-upload-aria-label","Stop uploading {{fileName}}",{fileName:l}),"aria-describedby":void 0,onClick:()=>{n()},onKeyDown:o})}),e.jsx(qe,{value:t.progress,"aria-label":s("new-request-form.attachments.uploading","Uploading {{fileName}}",{fileName:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{children:e.jsx(de,{isExternal:!0,href:t.value.url,target:"_blank",children:l})}),e.jsx(je,{content:a,children:e.jsx(he.Delete,{"aria-label":s("new-request-form.attachments.remove-file-aria-label","Remove file: {{fileName}}",{fileName:l}),"aria-describedby":void 0,onClick:()=>{n()},onKeyDown:o})}),e.jsx(qe,{value:100,"aria-hidden":"true"})]})})})}function un(t){const[n,s]=h.useState(t),i=h.useCallback((r,c,d)=>{s(m=>[...m,{status:"pending",id:r,file_name:c,progress:0,xhr:d}])},[]),o=h.useCallback((r,c)=>{s(d=>d.map(m=>m.status==="pending"&&m.id===r?R(q({},m),{progress:c}):m))},[]),l=h.useCallback(r=>{s(c=>c.filter(d=>d.status!=="pending"||d.id!==r))},[]),u=h.useCallback(r=>{s(c=>c.filter(d=>d.status!=="uploaded"||d.value.id!==r))},[]),a=h.useCallback((r,c)=>{s(d=>d.map(m=>m.status==="pending"&&m.id===r?{status:"uploaded",value:c}:m))},[]);return{files:n,addPendingFile:i,setPendingFileProgress:o,removePendingFile:l,removeUploadedFile:u,setUploaded:a}}function Re(){return N(this,null,function*(){const t=yield fetch("/api/v2/users/me.json"),{user:{authenticity_token:n}}=yield t.json();return n})}function dn({field:t}){var $;const{label:n,error:s,name:i,attachments:o}=t,{files:l,addPendingFile:u,setPendingFileProgress:a,setUploaded:r,removePendingFile:c,removeUploadedFile:d}=un(($=o.map(_=>({status:"uploaded",value:_})))!=null?$:[]),{addToast:m}=Ge(),{t:p}=H(),b=h.useCallback(_=>{m(({close:P})=>e.jsxs(Ne,{type:"error",children:[e.jsx(Me,{children:p("new-request-form.attachments.upload-error-title","Upload error")}),p("new-request-form.attachments.upload-error-description","There was an error uploading {{fileName}}. Try again or upload another file.",{fileName:_}),e.jsx(Ue,{"aria-label":p("new-request-form.close-label","Close"),onClick:P})]}))},[m,p]),v=h.useCallback(_=>N(this,null,function*(){const P=yield Re();for(const E of _){const w=new XMLHttpRequest,D=new URL(`${window.location.origin}/api/v2/uploads.json`);D.searchParams.append("filename",E.name),w.open("POST",D),E.type?w.setRequestHeader("Content-Type",E.type):w.setRequestHeader("Content-Type","application/octet-stream"),w.setRequestHeader("X-CSRF-Token",P),w.responseType="json";const F=crypto.randomUUID();u(F,E.name,w),w.upload.addEventListener("progress",({loaded:U,total:z})=>{const A=Math.round(U/z*100);A<=90&&a(F,A)}),w.addEventListener("load",()=>{if(w.status>=200&&w.status<300){const{upload:{attachment:{file_name:U,content_url:z},token:A}}=w.response;r(F,{id:A,file_name:U,url:z})}else b(E.name),c(F)}),w.addEventListener("error",()=>{b(E.name),c(F)}),w.send(E)}}),[u,c,a,r,b]),{getRootProps:x,getInputProps:y,isDragActive:f}=pt({onDrop:v}),k=_=>N(this,null,function*(){if(_.status==="pending")_.xhr.abort(),c(_.id);else{const P=yield Re(),E=_.value.id;d(_.value.id),yield fetch(`/api/v2/uploads/${E}.json`,{method:"DELETE",headers:{"X-CSRF-Token":P}})}});return e.jsxs(W,{children:[e.jsx(K,{children:n}),s&&e.jsx(Y,{validation:"error",children:s}),e.jsxs(ht,R(q({},x()),{isDragging:f,children:[f?e.jsx("span",{children:p("new-request-form.attachments.drop-files-label","Drop files here")}):e.jsx("span",{children:p("new-request-form.attachments.choose-file-label","Choose a file or drag and drop here")}),e.jsx(le,q({},y()))]})),e.jsx(He,{children:l.map(_=>e.jsx(cn,{file:_,onRemove:()=>{k(_)}},_.status==="pending"?_.id:_.value.id))}),l.map(_=>_.status==="uploaded"&&e.jsx("input",{type:"hidden",name:i,value:JSON.stringify(_.value)},_.value.id))]})}function We(t,n){return n.filter(s=>s.child_fields.some(i=>i.id===t))}function mn(t,n){return n.parent_field_type==="checkbox"&&n.value===!1?t===!1||t===null:t===n.value}function Ke(t,n,s){return t.filter(i=>{const o=s.find(u=>u.id===i.parent_field_id);if(!o)return!1;const l=We(o.id,n);return mn(o.value,i)&&(l.length===0||Ke(l,n,s).length>0)})}function pn(t,n){return n.length===0?t:t.reduce((s,i)=>{const o=We(i.id,n);if(o.length===0)return[...s,i];const l=Ke(o,n,t);return l.length>0?[...s,R(q({},i),{required:l.some(u=>u.child_fields.some(a=>a.id==i.id&&a.is_required))})]:s},[])}function $e({field:t,locale:n,valueFormat:s,onChange:i}){const{label:o,error:l,value:u,name:a,required:r,description:c}=t,[d,m]=h.useState(u?new Date(u):void 0),p=h.useCallback(y=>new Intl.DateTimeFormat(n,{month:"long",day:"numeric",year:"numeric",timeZone:"UTC"}).format(y),[n]),b=h.useCallback(y=>{if(y===void 0)return"";const f=y.toISOString();return s==="dateTime"?f:f.split("T")[0]},[s]),v=h.useCallback(y=>{const f=new Date(Date.UTC(y.getFullYear(),y.getMonth(),y.getDate(),12,0,0));m(f);const k=b(f);k!==void 0&&i(k)},[i,b]),x=y=>{y.target.value===""&&(m(void 0),i(""))};return e.jsxs(W,{children:[e.jsxs(K,{children:[o,r&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),c&&e.jsx(J,{dangerouslySetInnerHTML:{__html:c}}),e.jsx(ft,{value:d,onChange:v,formatDate:p,locale:n,children:e.jsx(le,{required:r,lang:n,onChange:x,validation:l?"error":void 0})}),l&&e.jsx(Y,{validation:"error",children:l}),e.jsx("input",{type:"hidden",name:a,value:b(d)})]})}function hn({tags:t,onTagsChange:n,inputValue:s,onInputValueChange:i,inputRef:o,gridRowRef:l,i18n:u}){const[a,r]=h.useState(0),[c,d]=h.useState(""),m=h.useCallback((g,C)=>{r(C)},[r]),{getGridProps:p,getGridCellProps:b}=gt({matrix:[t],rowIndex:0,colIndex:a,onChange:m}),v=g=>t.includes(g),x=g=>{n([...t,g]),d(u.addedTag(g))},y=g=>{const C=t[g];n(t.filter((S,L)=>L!==g)),d(u.removedTag(C)),r(0),setTimeout(()=>{var L;const S=(L=l.current)==null?void 0:L.querySelector('[tabindex="0"]');S==null||S.focus()},100)},f=g=>{var C;g.target===g.currentTarget&&((C=o.current)==null||C.focus())},k=()=>{r(0)},$=g=>{const S=g.target.value;S&&(g.key===oe.SPACE||g.key===oe.ENTER||g.key===oe.TAB||g.key===oe.COMMA)&&(g.preventDefault(),v(S)||x(S),i(""))},_=g=>{const C=g.target.value,[S,L]=[C.slice(0,-1),C.slice(-1)];L===" "||L===","?(S.length>0&&!v(S)&&x(S),i("")):i(C)},P=g=>{g.preventDefault();const C=g.clipboardData.getData("text"),S=new Set(C.split(/[\s,;]+/).filter(L=>!t.includes(L)));n([...t,...S]),d(u.addedTags([...S]))},E=g=>{const S=g.target.value;S&&(v(S)||x(S),i(""))},w=g=>C=>{C.code==="Backspace"&&(C.preventDefault(),y(g))},D=g=>()=>{y(g)};return{getContainerProps:()=>({onClick:f,onBlur:k,tabIndex:-1}),getGridProps:p,getGridRowProps:()=>({role:"row"}),getGridCellProps:g=>b({rowIndex:0,colIndex:g,onKeyDown:w(g)}),getTagCloseProps:g=>({onClick:D(g)}),getInputProps:()=>({value:s,onChange:_,onKeyDown:$,onPaste:P,onBlur:E}),announcement:c,getAnnouncementProps:()=>({"aria-live":"polite","aria-relevant":"text"})}}const fn=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,gn=I(ze)`
  padding: ${t=>`${t.theme.space.xxs} ${t.theme.space.sm}`};

  // Removes white spaces for inline elements
  font-size: 0;

  // Same as height of Tag size="large" + base space (4px)
  // to give some vertical space between tags
  --line-height: ${t=>t.theme.space.base*8+t.theme.space.base}px;
  line-height: var(--line-height);
`,Ae=I.span`
  display: inline-block;
  margin-right: ${t=>t.theme.space.sm};
`,xn=I(ve)`
  ${t=>xt({theme:t.theme,shadowWidth:"sm",selector:"&:focus"})}
`,jn=I.div`
  display: inline-block;
  position: relative;
`,vn=I(ze)`
  display: inline-block;
  min-width: 200px;
  opacity: 0;
  user-select: none;
  height: var(--line-height);
  line-height: var(--line-height);
`,bn=I(le)`
  position: absolute;
  top: 0;
  left: 0;
  height: var(--line-height);
  line-height: var(--line-height);
`;function yn({field:t}){const{label:n,value:s,name:i,error:o,description:l}=t,{t:u}=H(),a=s?s.split(",").map(w=>w.trim()):[],[r,c]=h.useState(a),[d,m]=h.useState(""),p=h.useRef(null),b=h.useRef(null),{getContainerProps:v,getGridProps:x,getGridRowProps:y,getGridCellProps:f,getTagCloseProps:k,getInputProps:$,getAnnouncementProps:_,announcement:P}=hn({tags:r,onTagsChange:c,inputValue:d,onInputValueChange:m,inputRef:p,gridRowRef:b,i18n:{addedTag:w=>u("new-request-form.cc-field.email-added","{{email}} has been added",{email:w}),removedTag:w=>u("new-request-form.cc-field.email-removed","{{email}} has been removed",{email:w}),addedTags:w=>u("new-request-form.cc-field.emails-added","{{emails}} have been added",{emails:w})}}),E=(w,D,F)=>e.jsxs(xn,{size:"large","aria-label":u("new-request-form.cc-field.email-label","{{email}} - Press Backspace to remove",{email:F}),hue:D?void 0:"red",children:[!D&&e.jsx(ve.Avatar,{children:e.jsx(jt,{})}),e.jsx("span",{children:F}),e.jsx(ve.Close,q({},k(w)))]});return e.jsxs(W,{children:[e.jsx(K,{children:n}),l&&e.jsx(J,{children:l}),e.jsxs(gn,R(q({},v()),{children:[r.length>0&&e.jsx("span",R(q({},x({"aria-label":u("new-request-form.cc-field.container-label","Selected CC emails")})),{children:e.jsx("span",R(q({ref:b},y()),{children:r.map((w,D)=>{const F=fn.test(w);return F?e.jsx(Ae,R(q({},f(D)),{children:E(D,F,w)}),D):e.jsx(je,{content:u("new-request-form.cc-field.invalid-email","Invalid email address"),children:e.jsx(Ae,R(q({},f(D)),{children:E(D,F,w)}))},D)})}))})),e.jsxs(jn,{children:[e.jsx(vn,{isBare:!0,"aria-hidden":"true",tabIndex:-1,children:d}),e.jsx(bn,q({ref:p,isBare:!0},$()))]})]})),o&&e.jsx(Y,{validation:"error",children:o}),r.map(w=>e.jsx("input",{type:"hidden",name:i,value:w},w)),e.jsx(M,R(q({hidden:!0},_()),{children:P}))]})}function wn(t){return t?t.replaceAll("X",""):""}const Cn=I(M)`
  margin-left: ${t=>t.theme.space.xxs};
  font-weight: ${t=>t.theme.fontWeights.medium};
`;function _n({field:t,onChange:n}){const{t:s}=H(),{label:i,error:o,value:l,name:u,required:a,description:r}=t,c=wn(l);return e.jsxs(W,{children:[e.jsxs(K,{children:[i,a&&e.jsx(M,{"aria-hidden":"true",children:"*"}),e.jsx(Cn,{children:s("new-request-form.credit-card-digits-hint","(Last 4 digits)")})]}),r&&e.jsx(J,{dangerouslySetInnerHTML:{__html:r}}),e.jsx(vt,{start:e.jsx(bt,{}),name:u,type:"text",value:c,onChange:d=>n(d.target.value),validation:o?"error":void 0,required:a,maxLength:4,placeholder:"XXXX"}),o&&e.jsx(Y,{validation:"error",children:o})]})}function kn({field:t,onChange:n}){const{label:s,options:i,error:o,value:l,name:u,required:a,description:r}=t,{currentGroup:c,isGroupIdentifier:d,setCurrentGroupByIdentifier:m}=Xe({options:i,hasEmptyOption:!0}),p=l!=null?l:"",[b,v]=h.useState(!1),x=h.useRef(null);h.useEffect(()=>{if(x.current&&a){const f=x.current.querySelector("[role=combobox]");f==null||f.setAttribute("aria-required","true")}},[x,a]);const y=f=>{if(typeof f.selectionValue=="string"&&d(f.selectionValue)){m(f.selectionValue);return}typeof f.selectionValue=="string"&&n(f.selectionValue),f.isExpanded!==void 0&&v(f.isExpanded)};return e.jsxs(ne,{children:[e.jsxs(se,{children:[s,a&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),r&&e.jsx(ce,{dangerouslySetInnerHTML:{__html:r}}),e.jsxs(re,{ref:x,inputProps:{required:a,name:u},isEditable:!1,validation:o?"error":void 0,onChange:y,selectionValue:p,inputValue:p,renderValue:({selection:f})=>{var k;return(k=f==null?void 0:f.label)!=null?k:e.jsx(te,{})},isExpanded:b,children:[c.type==="SubGroup"&&e.jsx(G,q({},c.backOption)),c.type==="SubGroup"?e.jsx(Ve,{"aria-label":c.name,children:c.options.map(f=>{var k;return e.jsx(G,R(q({},f),{children:(k=f.menuLabel)!=null?k:f.label}),f.value)})}):c.options.map(f=>f.value===""?e.jsx(G,R(q({},f),{children:e.jsx(te,{})}),f.value):e.jsx(G,q({},f),f.value))]}),o&&e.jsx(ue,{validation:"error",children:o})]})}function Sn(t,n){const[s,i]=h.useState(t);return h.useEffect(()=>{const o=setTimeout(()=>i(t),n);return()=>{clearTimeout(o)}},[t,n]),s}const qn=yt`
  from {
    grid-template-rows: 0fr;
  }
  to {
    grid-template-rows: 1fr;
  }
`,Tn=I.div`
  display: grid;
  animation: ${qn} 200ms forwards;
`,In=I.div`
  overflow: hidden;
`,Fn=I.ul`
  list-style: none;
  padding: 0;
  margin: 0;
`,En=I.li`
  margin: ${t=>t.theme.space.sm} 0;
`;function Pn(t){const n=t.charCodeAt(0);return n>=19968&&n<=195103?t.length>=2:t.length>=3}function Dn({query:t,locale:n}){const s=Sn(t,500),[i,o]=h.useState([]),l=h.useRef({}),{t:u}=H();return h.useEffect(()=>{const a=s==null?void 0:s.trim().toLocaleLowerCase();if(!a||!Pn(a)){o([]);return}const r=new URL(`${window.location.origin}/api/v2/help_center/deflection/suggestions.json`);r.searchParams.append("locale",n),r.searchParams.append("query",a);const c=l.current[r.toString()];if(c){o(c);return}fetch(r).then(d=>d.json()).then(({results:d})=>{l.current[r.toString()]=d,o(d)})},[s,n]),i.length>0?e.jsx(Tn,{"data-test-id":"suggested-articles",children:e.jsxs(In,{children:[e.jsx("h2",{children:u("new-request-form.suggested-articles","Suggested articles")}),e.jsx(Fn,{children:i.map(a=>e.jsx(En,{children:e.jsx(de,{href:a.html_url,children:a.name})},a.html_url))})]})}):null}const Ln=I.h3`
  font-size: ${t=>t.theme.fontSizes.md};
  font-weight: ${t=>t.theme.fontWeights.bold};
`,Rn=I(Ct)`
  color: ${t=>wt("successHue",700,t.theme)};
`,$n=I(_t)`
  position: absolute;
  top: ${t=>t.theme.space.base*5.5}px;
  inset-inline-start: ${t=>`${t.theme.space.base*4}px`};
`,An=I(de)`
  display: inline-block;
  margin-top: ${t=>t.theme.space.sm};
`;function On({authToken:t,interactionAccessToken:n,articles:s,requestId:i,hasRequestManagement:o,isSignedIn:l,helpCenterPath:u,requestsPath:a,requestPath:r}){const[c,d]=h.useState(0),m=kt(),{t:p}=H(),b=()=>{var k;return String((k=s[c])==null?void 0:k.article_id)},v=()=>{if(l)return o?r:u;{const k=new URLSearchParams;return k.set("return_to",a),`${u}?${k.toString()}`}},x=()=>{fe({type:"success",message:p("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")}),window.location.assign(v())},y=()=>N(this,null,function*(){(yield fetch("/api/v2/answer_bot/resolution",{method:"POST",body:JSON.stringify({article_id:b(),interaction_access_token:n}),headers:{"Content-Type":"application/json"}})).ok?fe({type:"success",message:p("new-request-form.answer-bot-modal.request-closed","Nice. Your request has been closed.")}):fe({type:"error",message:p("new-request-form.answer-bot-modal.solve-error","There was an error closing your request")}),window.location.href=u}),f=()=>N(this,null,function*(){yield fetch("/api/v2/answer_bot/rejection",{method:"POST",body:JSON.stringify({article_id:b(),interaction_access_token:n,reason_id:0}),headers:{"Content-Type":"application/json"}}),x()});return e.jsxs(St,{appendToNode:m,onClose:()=>{x()},children:[e.jsxs(Rn,{tag:"h2",children:[e.jsx($n,{}),p("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")]}),e.jsxs(qt,{children:[e.jsx(Ln,{children:p("new-request-form.answer-bot-modal.title","While you wait, do any of these articles answer your question?")}),e.jsx("p",{children:p("new-request-form.answer-bot-modal.footer-content","If it does, we can close your recent request {{requestId}}",{requestId:`‭#${i}‬`})}),e.jsx(Q,{level:4,expandedSections:[c],onChange:k=>{d(k)},children:s.map(({article_id:k,html_url:$,snippet:_,title:P})=>e.jsxs(Q.Section,{children:[e.jsx(Q.Header,{children:e.jsx(Q.Label,{children:P})}),e.jsxs(Q.Panel,{children:[e.jsx(Be,{dangerouslySetInnerHTML:{__html:_}}),e.jsx(An,{isExternal:!0,href:`${$}?auth_token=${t}`,target:"_blank",children:p("new-request-form.answer-bot-modal.view-article","View article")})]})]},k))})]}),e.jsxs(Tt,{children:[e.jsx(Te,{children:e.jsx(be,{onClick:()=>{f()},children:p("new-request-form.answer-bot-modal.mark-irrelevant","No, I need help")})}),e.jsx(Te,{children:e.jsx(be,{isPrimary:!0,onClick:()=>{y()},children:p("new-request-form.answer-bot-modal.solve-request","Yes, close my request")})})]}),e.jsx(It,{"aria-label":p("new-request-form.close-label","Close")})]})}function Gn(t){return t.replace("zen:custom_object:","")}const ee={value:"",name:"-"};function Nn({field:t,userId:n,organizationId:s,onChange:i}){const{id:o,label:l,error:u,value:a,name:r,required:c,description:d,relationship_target_type:m}=t,[p,b]=h.useState([]),[v,x]=h.useState(null),[y,f]=h.useState(a),[k,$]=h.useState(!1),{t:_}=H(),P=Gn(m),E={name:_("new-request-form.lookup-field.loading-options","Loading items..."),id:"loading"},w={name:_("new-request-form.lookup-field.no-matches-found","No matches found"),id:"no-results"},D=h.useCallback(O=>N(this,null,function*(){try{const g=yield fetch(`/api/v2/custom_objects/${P}/records/${O}`);if(g.ok){const{custom_object_record:C}=yield g.json(),S={name:C.name,value:C.id};x(S),f(C.name)}}catch(g){console.error(g)}}),[P]),F=h.useCallback(O=>N(this,null,function*(){const g=new URLSearchParams;g.set("name",O.toLocaleLowerCase()),g.set("source","zen:ticket"),g.set("field_id",o.toString()),g.set("requester_id",n.toString()),s!==null&&g.set("organization_id",s),$(!0);try{const C=yield fetch(`/api/v2/custom_objects/${P}/records/autocomplete?${g.toString()}`),S=yield C.json();if(C.ok){let L=S.custom_object_records.map(({name:B,id:me})=>({name:B,value:me}));v&&(L=L.filter(B=>B.value!==v.value),L=[v,...L]),b(L)}else b([])}catch(C){console.error(C)}finally{$(!1)}}),[P,o,s,v,n]),U=h.useMemo(()=>Ft(F,300),[F]);h.useEffect(()=>()=>U.cancel(),[U]);const z=h.useCallback(({inputValue:O,selectionValue:g})=>{if(g!==void 0)if(g=="")x(ee),f(ee.name),b([]),i(ee.value);else{const C=p.find(S=>S.value===g);C&&(f(C.name),x(C),b([C]),i(C.value))}O!==void 0&&(f(O),U(O))},[U,i,p]);h.useEffect(()=>{a&&D(a)},[]);const A=()=>{f(""),F("*")};return e.jsxs(ne,{children:[e.jsxs(se,{children:[l,c&&e.jsx(M,{"aria-hidden":"true",children:"*"})]}),d&&e.jsx(ce,{dangerouslySetInnerHTML:{__html:d}}),e.jsxs(re,{inputProps:{required:c},"data-test-id":"lookup-field-combobox",validation:u?"error":void 0,inputValue:y,selectionValue:v==null?void 0:v.value,isAutocomplete:!0,placeholder:_("new-request-form.lookup-field.placeholder","Search {{label}}",{label:l.toLowerCase()}),onFocus:A,onChange:z,renderValue:()=>v?v==null?void 0:v.name:ee.name,children:[(v==null?void 0:v.name)!==ee.name&&e.jsx(G,{value:"",label:"-",children:e.jsx(te,{})}),k&&e.jsx(G,{isDisabled:!0,value:E.name},E.id),!k&&(y==null?void 0:y.length)>0&&p.length===0&&e.jsx(G,{isDisabled:!0,value:w.name},w.id),!k&&p.length!==0&&p.map(O=>e.jsx(G,{value:O.value,label:O.name,"data-test-id":`option-${O.name}`},O.value))]}),u&&e.jsx(ue,{validation:"error",children:u}),e.jsx("input",{type:"hidden",name:r,value:v==null?void 0:v.value})]})}const Oe=I(Be)`
  margin: ${t=>t.theme.space.md} 0;
`,Mn=I.form`
  display: flex;
  flex-direction: column;
  gap: ${t=>t.theme.space.md};
`,Un=I.div`
  margin-top: ${t=>t.theme.space.md};
`;function Vn({requestForm:t,wysiwyg:n,newRequestPath:s,parentId:i,parentIdPath:o,locale:l,baseLocale:u,hasAtMentions:a,userRole:r,userId:c,brandId:d,organizations:m,answerBotModal:p}){var we,Ce,_e;const{ticket_fields:b,action:v,http_method:x,accept_charset:y,errors:f,parent_id_field:k,ticket_form_field:$,email_field:_,cc_field:P,organization_field:E,due_date_field:w,end_user_conditions:D,attachments_field:F,inline_attachments_fields:U,description_mimetype_field:z}=t,{answerBot:A}=p,{ticketFields:O,emailField:g,ccField:C,organizationField:S,dueDateField:L}=ln({ticketFields:b,emailField:_,ccField:P,organizationField:E,dueDateField:w}),[B,me]=h.useState(O),[X,Ye]=h.useState(S),[ae,Je]=h.useState(L),Ze=pn(B,D),{formRefCallback:Qe,handleSubmit:et}=Qt(B),{t:pe}=H(),tt=m.length>0&&((we=m[0])!=null&&we.id)?(_e=(Ce=m[0])==null?void 0:Ce.id)==null?void 0:_e.toString():null,V=h.useCallback((j,T)=>{me(B.map(Z=>Z.name===j.name?R(q({},Z),{value:T}):Z))},[B]);function nt(j){X!==null&&Ye(R(q({},X),{value:j}))}const st=h.useCallback(j=>{ae!==null&&Je(R(q({},ae),{value:j}))},[ae]);return e.jsxs(e.Fragment,{children:[i&&e.jsx(Oe,{children:e.jsx(de,{href:o,children:pe("new-request-form.parent-request-link","Follow-up to request {{parentId}}",{parentId:`‭#${i}‬`})})}),e.jsx(Oe,{"aria-hidden":"true",children:pe("new-request-form.required-fields-info","Fields marked with an asterisk (*) are required.")}),e.jsxs(Mn,{ref:Qe,action:v,method:x,acceptCharset:y,noValidate:!0,onSubmit:et,children:[f&&e.jsx(Et,{type:"error",children:f}),k&&e.jsx(Jt,{field:k}),$.options.length>0&&e.jsx(Yt,{field:$,newRequestPath:s}),g&&e.jsx(ge,{field:g},g.name),C&&e.jsx(yn,{field:C}),X&&e.jsx(Ee,{field:X,onChange:j=>{nt(j)}},X.name),Ze.map(j=>{switch(j.type){case"subject":return e.jsxs(h.Fragment,{children:[e.jsx(ge,{field:j,onChange:T=>V(j,T)}),e.jsx(Dn,{query:j.value,locale:l})]},j.name);case"text":case"integer":case"decimal":case"regexp":return e.jsx(ge,{field:j,onChange:T=>V(j,T)},j.name);case"partialcreditcard":return e.jsx(_n,{field:j,onChange:T=>V(j,T)},j.name);case"description":return e.jsxs(h.Fragment,{children:[e.jsx(Fe,{field:j,hasWysiwyg:n,baseLocale:u,hasAtMentions:a,userRole:r,brandId:d,onChange:T=>V(j,T)}),e.jsx("input",{type:"hidden",name:z.name,value:n?"text/html":"text/plain"})]},j.name);case"textarea":return e.jsx(Fe,{field:j,hasWysiwyg:!1,baseLocale:u,hasAtMentions:a,userRole:r,brandId:d,onChange:T=>V(j,T)},j.name);case"priority":case"basic_priority":case"tickettype":return e.jsxs(h.Fragment,{children:[e.jsx(Ee,{field:j,onChange:T=>V(j,T)}),j.value==="task"&&e.jsx($e,{field:ae,locale:u,valueFormat:"dateTime",onChange:T=>{st(T)}})]},j.name);case"checkbox":return e.jsx(Ht,{field:j,onChange:T=>V(j,T)},j.name);case"date":return e.jsx($e,{field:j,locale:u,valueFormat:"date",onChange:T=>V(j,T)},j.name);case"multiselect":return e.jsx(Kt,{field:j},j.name);case"tagger":return e.jsx(kn,{field:j,onChange:T=>V(j,T)},j.name);case"lookup":return e.jsx(Nn,{field:j,userId:c,organizationId:X!==null?X.value:tt,onChange:T=>V(j,T)},j.name);default:return e.jsx(h.Fragment,{},j.name)}}),F&&e.jsx(dn,{field:F}),U.map(({type:j,name:T,value:Z},rt)=>e.jsx("input",{type:j,name:T,value:Z},rt)),e.jsx(Un,{children:($.options.length===0||$.value)&&e.jsx(be,{isPrimary:!0,type:"submit",children:pe("new-request-form.submit","Submit")})})]}),A.auth_token&&A.interaction_access_token&&A.articles.length>0&&A.request_id&&e.jsx(On,q({authToken:A.auth_token,interactionAccessToken:A.interaction_access_token,articles:A.articles,requestId:A.request_id},p))]})}function Hn(t,n,s){return N(this,null,function*(){const{baseLocale:i}=n;Pt(i),yield Dt(i),Lt.render(e.jsx(Rt,{theme:$t(t),children:e.jsx(Vn,q({},n))}),s)})}window.renderNewRequestForm=Hn;At("new-request-form");
